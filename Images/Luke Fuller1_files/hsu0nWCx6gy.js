if (self.CavalryLogger) { CavalryLogger.start_js(["ZW5cw"]); }

__d("VisualCompletionInst",["csx","getElementRect","gkx","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=/url\(.*(http.*)\)/gi,i=1,j=0;function a(a){this.$5=new Map(),this.$3=new Map(),this.$1=[],this.$2=[],this.$8=0,this.$12=a}a.prototype.calculate=function(a,c,d){__p&&__p();if(!this.$12.size)return null;j++;var e=b("performanceAbsoluteNow")();this.$4=a;this.$8=0;this.$10=0;this.$11=0;this.setResourceTimingMap();this.setViewportSize();this.initTree();this.getImages();b("gkx")("676838")&&this.getBackgroundImages();this.$9=this.traverseTree(this.$1,this.$6.width*this.$6.height);var f={viewport:this.$6,totalPixels:this.$9,paintedPixels:this.$10,bgNum:0,imgNum:0,compNum:0,bgPixels:0,imgPixels:0,compPixels:0,elements:this.$2,calcLatency:0,bgChecked:this.$8,bgCheckLatency:this.$11,speedIndex:0,startTime:a,visuallyComplete:0,scrollY:window.scrollY,navSequence:j,pageType:c,page:d};this.$2.length&&(this.$2=this.$2.sort(function(a,b){return b.latency-a.latency}),f.visuallyComplete=this.$2[0].latency,this.$2.forEach(function(a){__p&&__p();f.speedIndex+=a.pixels/this.$10*a.latency;switch(a.type){case"component":f.compNum++;f.compPixels+=a.pixels;break;case"img":f.imgNum++;f.imgPixels+=a.pixels;break;case"bg":f.bgNum++;f.bgPixels+=a.pixels;break}}.bind(this)));f.calcLatency=b("performanceAbsoluteNow")()-e;return f};a.prototype.findParent=function(a){a=a.parentElement;while(a){var b=a.getAttribute("data-veid");if(b!=null&&b!==""&&this.$3.has(b))return this.$3.get(b);a=a.parentElement}return null};a.prototype.getBackgroundImages=function(){__p&&__p();var a=b("performanceAbsoluteNow")();this.$1.forEach(function(a){__p&&__p();a=a.element.querySelectorAll(":not(img)");a.forEach(function(a){__p&&__p();var b=this.findParent(a);if(!b)return;var c=this.getRectangle(a,b.rectangle),d=this.getPixels(c);if(!d)return;var e=this.trimHash(this.getStyleBackground(a));if(e!=null&&e!==""&&this.$5.has(e)){a={veid:String(i++),element:a,rectangle:c,pixels:d,children:[],parent:b,type:"bg",latency:this.$5.get(e)+performance.timing.navigationStart-this.$4,timestamp:this.$5.get(e)+performance.timing.navigationStart,url:e};b.children.push(a)}}.bind(this))}.bind(this));this.$11=b("performanceAbsoluteNow")()-a};a.prototype.getImages=function(){__p&&__p();var a=document.querySelectorAll("img");a.forEach(function(a){__p&&__p();var b=this.findParent(a);if(!b)return;var c=this.getRectangle(a,b.rectangle);if(a.parentElement){var d=this.getRectangle(a.parentElement,b.rectangle);c=this.getRectIntersection(c,d)}d=this.getPixels(c);if(!d)return;var e=this.trimHash(a.getAttribute("src"));if(e!=null&&e!==""&&this.$5.has(e)){a={veid:String(i++),element:a,rectangle:c,pixels:d,children:[],parent:b,type:"img",latency:this.$5.get(e)+performance.timing.navigationStart-this.$4,timestamp:this.$5.get(e)+performance.timing.navigationStart,url:e};b.children.push(a)}}.bind(this))};a.prototype.getPixels=function(a){return(a.right-a.left)*(a.bottom-a.top)};a.prototype.getRectangle=function(a,c){a=b("getElementRect")(a);return this.getRectIntersection(a,c)};a.prototype.getRectIntersection=function(a,b){return{top:Math.min(Math.max(a.top,b.top),b.bottom),bottom:Math.max(Math.min(a.bottom,b.bottom),b.top),left:Math.min(Math.max(a.left,b.left),b.right),right:Math.max(Math.min(a.right,b.right),b.left)}};a.prototype.getStyleBackground=function(a){__p&&__p();if(typeof window.getComputedStyle!=="function")return null;this.$8++;a=window.getComputedStyle(a);var b=a["background-image"];if(a.visibility!=="hidden"&&b&&b!=="none"){h.lastIndex=0;a=h.exec(b);if(a&&a.length>1)return a[1].replace('"',"")}return null};a.prototype.initTree=function(){__p&&__p();var a={top:0,left:0,bottom:this.$6.height,right:this.$6.width};this.$12.forEach(function(b){var c=b[0],d=b[1];b=b[2];var e=this.getRectangle(d,a);if(this.getPixels(e)===0)d.removeAttribute("data-veid"),this.$12["delete"](c);else{d={veid:c,element:d,rectangle:e,pixels:this.getPixels(e),children:[],parent:null,type:"component",latency:b-this.$4,timestamp:b};this.$3.set(c,d)}}.bind(this));this.$3.forEach(function(a){var b=this.findParent(a.element);b?(a.rectangle=this.getRectIntersection(a.rectangle,b.rectangle),a.pixels=this.getPixels(a.rectangle),b.children.push(a),a.parent=b):(this.$1.forEach(function(b){b=this.getRectIntersection(a.rectangle,b.rectangle);this.getPixels(b)>0&&(a.rectangle.top=b.bottom,a.pixels=this.getPixels(a.rectangle))}.bind(this)),this.$1.push(a))}.bind(this))};a.prototype.setResourceTimingMap=function(){if(window.performance&&typeof window.performance.getEntriesByType==="function"){var a=window.performance.getEntriesByType("resource");a.forEach(function(a){var b=this.trimHash(a.name);b!=null&&b!==""&&this.$5.set(b,a.responseEnd)}.bind(this))}};a.prototype.setViewportSize=function(){this.$6={width:window.innerWidth,height:window.innerHeight}};a.prototype.traverseTree=function(a,b){var c=b,d=0;a.sort(function(a,b){return b.timestamp-a.timestamp}).forEach(function(a){a.pixels=Math.min(c,a.pixels),d+=a.pixels,c-=a.pixels,a.pixels-=this.traverseTree(a.children,a.pixels),a.timestamp>this.$4&&(a.type!=="component"&&a.parent&&a.parent.timestamp>a.timestamp&&(a.latency=a.parent.latency),this.$10+=a.pixels,this.$2.push(a))}.bind(this));return d};a.prototype.trimHash=function(a){return a!=null&&a!==""&&a.indexOf("#")>=0?a.substring(0,a.indexOf("#")):a};e.exports=a}),null);
__d("CometVisualCompletionQuickLogModule",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({BLUE_SPEED_INDEX_WWW:27983876,BLUE_VISUALLY_COMPLETE_WWW:27983875,COMET_SPEED_INDEX_WWW:27983874,COMET_VISUALLY_COMPLETE_WWW:27983873})}),null);
__d("VisualCompletionQPL",["CometVisualCompletionQuickLogModule","QuickPerformanceLogger","VisibilityListener","performance","performanceNavigationStart"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={log:function(a){__p&&__p();if(a.navSequence>1)return;if(a.page!=="/home.php:topnews")return;var c=b("VisibilityListener").getHiddenTime(a.startTime,a.startTime+a.visuallyComplete);c=c!=null&&c>0?1:0;b("QuickPerformanceLogger").markerStartFromNavStart(b("CometVisualCompletionQuickLogModule").BLUE_VISUALLY_COMPLETE_WWW);var d=a.navSequence===1&&b("performance")&&b("performance").timing&&b("performance").timing.responseStart;d&&b("QuickPerformanceLogger").markerPoint(b("CometVisualCompletionQuickLogModule").BLUE_VISUALLY_COMPLETE_WWW,"TTFB",null,0,d);if(a.elements.length){d=a.elements[a.elements.length-1].timestamp;b("QuickPerformanceLogger").markerPoint(b("CometVisualCompletionQuickLogModule").BLUE_VISUALLY_COMPLETE_WWW,"FP",null,0,d)}b("QuickPerformanceLogger").annotateMarkerInt(b("CometVisualCompletionQuickLogModule").BLUE_VISUALLY_COMPLETE_WWW,"hidden",c);b("QuickPerformanceLogger").annotateMarkerInt(b("CometVisualCompletionQuickLogModule").BLUE_VISUALLY_COMPLETE_WWW,"height",a.viewport.height);b("QuickPerformanceLogger").annotateMarkerInt(b("CometVisualCompletionQuickLogModule").BLUE_VISUALLY_COMPLETE_WWW,"width",a.viewport.width);b("QuickPerformanceLogger").annotateMarkerInt(b("CometVisualCompletionQuickLogModule").BLUE_VISUALLY_COMPLETE_WWW,"overhead",a.calcLatency);b("QuickPerformanceLogger").markerEnd(b("CometVisualCompletionQuickLogModule").BLUE_VISUALLY_COMPLETE_WWW,"SUCCESS",0,a.visuallyComplete+b("performanceNavigationStart")());b("QuickPerformanceLogger").markerStartFromNavStart(b("CometVisualCompletionQuickLogModule").BLUE_SPEED_INDEX_WWW);b("QuickPerformanceLogger").annotateMarkerInt(b("CometVisualCompletionQuickLogModule").BLUE_SPEED_INDEX_WWW,"hidden",c);b("QuickPerformanceLogger").annotateMarkerInt(b("CometVisualCompletionQuickLogModule").BLUE_SPEED_INDEX_WWW,"height",a.viewport.height);b("QuickPerformanceLogger").annotateMarkerInt(b("CometVisualCompletionQuickLogModule").BLUE_SPEED_INDEX_WWW,"width",a.viewport.width);b("QuickPerformanceLogger").annotateMarkerInt(b("CometVisualCompletionQuickLogModule").BLUE_SPEED_INDEX_WWW,"overhead",a.calcLatency);b("QuickPerformanceLogger").markerEnd(b("CometVisualCompletionQuickLogModule").BLUE_SPEED_INDEX_WWW,"SUCCESS",0,a.speedIndex+b("performanceNavigationStart")())}};e.exports=a}),null);
__d("VisualCompletion",["csx","NavigationMetrics","VisualCompletionInst","VisualCompletionQPL"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=!1,i,j=[],k=new Set(),l=new Map(),m=1;function n(a,b){if(!a)return;var c="vc_"+m++,d=a.getAttribute("data-veid");d!=null&&d!==""&&l["delete"](d);a.setAttribute("data-veid",c);l.set(c,[c,a,b])}function o(){j.forEach(function(a){a(i)}),i&&b("VisualCompletionQPL").log(i)}var p={addElements:function(a,b,c){__p&&__p();h||p.init();b&&b.forEach(function(a){n(a,c)});if(a==="first_response"){if(k.has(a))return;b=document.getElementById("pagelet_bluebar");if(b!=null){b=b.querySelector("._2s1y");b&&n(b,c)}k.add(a)}else if(a==="pagelet_sidebar"){if(k.has(a))return;b=document.getElementById("pagelet_sidebar");if(b!=null){b=b.querySelector("._51x_");b&&n(b,c)}k.add(a)}},getReport:function(){return i},init:function(){b("NavigationMetrics").addRetroactiveListener(b("NavigationMetrics").Events.NAVIGATION_DONE,function(a,c){if(c.pageType!=="normal"&&c.pageType!=="quickling")return;a=new(b("VisualCompletionInst"))(l);i=a.calculate(c.start,c.pageType,c.page);o()}),h=!0},subscribe:function(a){j.push(a)},unsubscribe:function(a){j=j.filter(function(b){return b!==a})}};e.exports=p}),null);